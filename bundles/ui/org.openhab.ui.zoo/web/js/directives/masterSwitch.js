// Generated by CoffeeScript 1.9.1
'use strict';
angular.module('ZooLib.directives.masterSwitch', []).directive('masterSwitch', function($log, itemService) {
  return {
    restrict: 'E',
    replace: true,
    templateUrl: 'partials/directives/masterSwitch.html',
    scope: {
      item: '='
    },
    link: function(scope) {
      var updateItem;
      updateItem = function(newState) {
        scope.item.state = newState;
        return scope.$apply();
      };
      scope.$watch('item.state', function(state, oldState) {
        if (state === oldState) {
          return;
        }
        itemService.sendCommand({
          itemName: scope.item.name
        }, state);
        return $log.log("Changed state of " + scope.item.label + " from " + oldState + " to " + state);
      });
      scope.$watch('item', function(item) {
        if (item == null) {
          return;
        }
        return scope.$on("smarthome/command/" + item.name, function(event, newState) {
          return updateItem(newState);
        });
      });
    }
  };
});
