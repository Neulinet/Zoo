// Generated by CoffeeScript 1.9.1
angular.module('ZooLib.directives.DimmerItem', []).directive('dimmerItem', function() {
  return {
    restrict: 'E',
    replace: true,
    templateUrl: 'partials/directives/dimmerItem.html',
    scope: {
      item: '=',
      onoff: '=',
      dim: '='
    },
    link: function(scope, elem, attrs) {
      var i, len, options, ref, setOpacity, tag;
      scope.options = {
        cctv: attrs.cctv != null,
        opacity: .5
      };
      ref = scope.item.tags;
      for (i = 0, len = ref.length; i < len; i++) {
        tag = ref[i];
        if (tag === 'power') {
          scope.options.cssIconClass = 'i-power';
        }
        if (tag === 'light') {
          scope.options.cssIconClass = 'i-light-on-small';
        }
      }
      setOpacity = function() {
        var newOpacity;
        newOpacity = scope.dim / 100;
        if (newOpacity < .1) {
          newOpacity = .1;
        }
        if (newOpacity > .9) {
          newOpacity = .9;
        }
        return scope.options.opacity = newOpacity;
      };
      options = {
        callback: setOpacity,
        decimal: true,
        min: 0,
        max: 100,
        start: scope.dim || 0
      };
      new Powerange($('.js-opacity', elem)[0], options);
      if (scope.options.cctv) {
        $('.popup-with-move-anim', elem).magnificPopup({
          type: 'inline',
          fixedContentPos: true,
          fixedBgPos: false,
          closeBtnInside: true,
          preloader: false,
          midClick: true,
          removalDelay: 300,
          mainClass: 'my-mfp-slide-bottom'
        });
      }
    }
  };
});
